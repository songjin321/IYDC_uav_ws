# 无人机比赛上位机框架

# 无人机部分

无人机部分指的是运行在小电脑上软件.主要负责无人机的定位,建图,目标检测,追踪,无人机的路径规划,无人机挂载执行器的工作.

本次比赛总共有四个任务.为了完成这四个任务,无人机需实现以下功能:

## 比赛无人软件运行流程

赛前准备:采用orbslam或者rovioli来构建地图,地图中应该包含用来
定位的特征点信息和四个任务的目标物位置

## 各个模块

1. 定位包 localization

    - 读入图像,实时给出无人的位置->给飞控用于控制无人机

2. 轨迹规划

   - 不需要考虑碰撞
   - 搜寻模式进行轨迹规划
   - 给定一个目标点,call这个服务后,这个服务结合地图,给出一条轨迹(带时间的用来控制无人机)
   - 给定目标在图像中的位置,结合无人机的位姿,假定目标在水平面上不动,做一个滤波器确定其位置
   - 针对任务三需要认为目标物是动进行速度预测

3. 无人机运动控制

   - 订阅轨迹,来控制无人机运动

4. 无人机操作部分服务

   - 闪灯->返回是否OK
   - 松开
   - 抓取->返回时候OK

5. 目标检测服务

   - 给定一张图片,和相应的检测代号,返回box


6. 目标追踪节点

   - 给定一个box启动后,接受下一帧图片不断返回box中心点

7. 自动飞行主程序包, auto_fly

   - 有四个节点，对应四个子任务
   - 四个节点的主要代码框架都差不多，但什么时候开启检测什么时候结束追踪是有区别的

8. 手动飞行程序包

   - 用于手动飞行，参考之前的项目

## 运行建图模式

拿着无人机在场地中实时跑几圈，建好相对应的地图，并且
输出四个任务的任务点

## 运行自动模式

上电解锁后脚本自动运行rosrun auto_fly main,
依据遥控器信号运行不同的指令．**可能不够稳定，考虑直接在地面站运行roslaunch 脚本**

### 1. roslaunch auto_fly task1.launch

先把定位跑起来，注意飞机每次都要摆到与建图的时候相同的起始点．
运行task1,飞到任务１的相对应的位置，巡航，进行目标检测，检测
到目标物后，追踪保证其在视野中心．
物体和飞机均不动，后开始调用声音和闪灯，６秒后返回．上锁
roslaunch auto_fly allrelative.launch
rosrun auto_fly task2.launch

### 2. roslaunch auto_fly task2.launch

稳定后，调用声音和闪灯6秒．第2秒的时候调用释放的服务，６秒到了就返回
返回过程不运行检测和追踪

### 3. roslaunch auto_fly task3.launch



## 运行手动模式

manual_fly，无人机只运行定位包，接受地面的键盘控制，并传输图像到地面
参考前一个项目

# 地面站部分

实时接受并显示x相关的无人机的各种状态，rqt_rviz
远程对无人机进行控制

# 辅助Debug的库

- 显示，订阅Pose转化为odometry
- 坐标系转换，用tf表示要好一点
- 将需要的修改的参数设定为rosparam,放入到launch文件中，这样就可以不用每次都重新
进行编译了

# 写一个自动测试工具来测试相应的算法是否可行，可以使用标准数据集

# 无人机导航包，slam定位，建图，路径规划．基于这个再做上层应用